#!/bin/bash

ARGS=""

# Function to display help
help() {
    echo ""
    echo "USB Power Commander"
    echo ""
    echo "  Arguments:"
    echo "    host:  Specify the host to control."
    echo "    port:  Specify one or more ports to operate on the specified host."
    echo ""
    echo "  Environment Variables:"
    echo "    USB_COMMANDER_IP:  If set, the script uses this IP instead of default settings."
    echo ""
    echo "  Usage: hub <host> <port> [...]"
    echo ""
}

# Check for help option
if [[ "$1" == "-h" ]] || [[ "$1" == "--help" ]]; then
    help
    exit 0
fi

# check if USB_COMMANDER_IP is set in environment
if [ ! -z "$USB_COMMANDER_IP" ]; then
    ARGS+=$USB_COMMANDER_IP
fi

SCRIPT=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )/_hub.py

if [ -z "$1" ]; then
    python3 $SCRIPT --status
    exit 0
fi

if [ -z $2 ]; then
    echo "Error: Missing port argument"
    help
    exit 0
fi

host=$1
shift

$SCRIPT --host $host --ports $@
